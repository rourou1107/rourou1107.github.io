<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES5、ES6 创建 class 组件写法 | 肉肉的博客</title>
    <meta name="description" content="肉肉的前端记录">
    <link rel="icon" href="  ./logo.jpg">
    
    <link rel="preload" href="/dist/assets/css/0.styles.8ccbe093.css" as="style"><link rel="preload" href="/dist/assets/js/app.a7341da6.js" as="script"><link rel="preload" href="/dist/assets/js/2.4917c22f.js" as="script"><link rel="preload" href="/dist/assets/js/58.617cc871.js" as="script"><link rel="prefetch" href="/dist/assets/js/10.28417dbc.js"><link rel="prefetch" href="/dist/assets/js/100.8df93c68.js"><link rel="prefetch" href="/dist/assets/js/101.b2508800.js"><link rel="prefetch" href="/dist/assets/js/102.1eb5f784.js"><link rel="prefetch" href="/dist/assets/js/103.a84179fd.js"><link rel="prefetch" href="/dist/assets/js/11.d2d6f458.js"><link rel="prefetch" href="/dist/assets/js/12.d9e11744.js"><link rel="prefetch" href="/dist/assets/js/13.0c8d9c4f.js"><link rel="prefetch" href="/dist/assets/js/14.8d237cbd.js"><link rel="prefetch" href="/dist/assets/js/15.11c8763a.js"><link rel="prefetch" href="/dist/assets/js/16.3b2a6718.js"><link rel="prefetch" href="/dist/assets/js/17.48f592f2.js"><link rel="prefetch" href="/dist/assets/js/18.403c0073.js"><link rel="prefetch" href="/dist/assets/js/19.97457cd3.js"><link rel="prefetch" href="/dist/assets/js/20.62c6222e.js"><link rel="prefetch" href="/dist/assets/js/21.57997f72.js"><link rel="prefetch" href="/dist/assets/js/22.4c63e11f.js"><link rel="prefetch" href="/dist/assets/js/23.97d1871c.js"><link rel="prefetch" href="/dist/assets/js/24.05cb34b7.js"><link rel="prefetch" href="/dist/assets/js/25.4fbdf6b4.js"><link rel="prefetch" href="/dist/assets/js/26.49e91473.js"><link rel="prefetch" href="/dist/assets/js/27.681c7849.js"><link rel="prefetch" href="/dist/assets/js/28.e365bd08.js"><link rel="prefetch" href="/dist/assets/js/29.05be1bdb.js"><link rel="prefetch" href="/dist/assets/js/3.5ecd6063.js"><link rel="prefetch" href="/dist/assets/js/30.32a688bd.js"><link rel="prefetch" href="/dist/assets/js/31.163eb102.js"><link rel="prefetch" href="/dist/assets/js/32.a2d13506.js"><link rel="prefetch" href="/dist/assets/js/33.e0602788.js"><link rel="prefetch" href="/dist/assets/js/34.33c5189c.js"><link rel="prefetch" href="/dist/assets/js/35.bdbe648a.js"><link rel="prefetch" href="/dist/assets/js/36.3fd6c693.js"><link rel="prefetch" href="/dist/assets/js/37.52cf1de7.js"><link rel="prefetch" href="/dist/assets/js/38.4bb4d020.js"><link rel="prefetch" href="/dist/assets/js/39.7f0c5025.js"><link rel="prefetch" href="/dist/assets/js/4.4e90b1da.js"><link rel="prefetch" href="/dist/assets/js/40.286b4e9c.js"><link rel="prefetch" href="/dist/assets/js/41.1b286fb0.js"><link rel="prefetch" href="/dist/assets/js/42.3fdd8d39.js"><link rel="prefetch" href="/dist/assets/js/43.00ba2bb6.js"><link rel="prefetch" href="/dist/assets/js/44.1ab20084.js"><link rel="prefetch" href="/dist/assets/js/45.1c96affa.js"><link rel="prefetch" href="/dist/assets/js/46.124ca510.js"><link rel="prefetch" href="/dist/assets/js/47.50ff79e1.js"><link rel="prefetch" href="/dist/assets/js/48.7c58bdac.js"><link rel="prefetch" href="/dist/assets/js/49.60b1bc0a.js"><link rel="prefetch" href="/dist/assets/js/5.5ecde460.js"><link rel="prefetch" href="/dist/assets/js/50.fe1d9a67.js"><link rel="prefetch" href="/dist/assets/js/51.3e8370d5.js"><link rel="prefetch" href="/dist/assets/js/52.bc1935aa.js"><link rel="prefetch" href="/dist/assets/js/53.ff3ec3f4.js"><link rel="prefetch" href="/dist/assets/js/54.93bbb7ee.js"><link rel="prefetch" href="/dist/assets/js/55.01632345.js"><link rel="prefetch" href="/dist/assets/js/56.5fc9e7f3.js"><link rel="prefetch" href="/dist/assets/js/57.bc67a037.js"><link rel="prefetch" href="/dist/assets/js/59.3b60e13e.js"><link rel="prefetch" href="/dist/assets/js/6.3a2d05d5.js"><link rel="prefetch" href="/dist/assets/js/60.320c57d9.js"><link rel="prefetch" href="/dist/assets/js/61.0093ab14.js"><link rel="prefetch" href="/dist/assets/js/62.bd18ce72.js"><link rel="prefetch" href="/dist/assets/js/63.6f1f6d21.js"><link rel="prefetch" href="/dist/assets/js/64.19ef187a.js"><link rel="prefetch" href="/dist/assets/js/65.f5336158.js"><link rel="prefetch" href="/dist/assets/js/66.83775b7d.js"><link rel="prefetch" href="/dist/assets/js/67.e0735ad3.js"><link rel="prefetch" href="/dist/assets/js/68.c1573861.js"><link rel="prefetch" href="/dist/assets/js/69.24a76738.js"><link rel="prefetch" href="/dist/assets/js/7.3e8e8de4.js"><link rel="prefetch" href="/dist/assets/js/70.55f63290.js"><link rel="prefetch" href="/dist/assets/js/71.b2969113.js"><link rel="prefetch" href="/dist/assets/js/72.b9fc90b9.js"><link rel="prefetch" href="/dist/assets/js/73.853eb1b4.js"><link rel="prefetch" href="/dist/assets/js/74.fc968cb0.js"><link rel="prefetch" href="/dist/assets/js/75.80548253.js"><link rel="prefetch" href="/dist/assets/js/76.b72ba034.js"><link rel="prefetch" href="/dist/assets/js/77.8e03d3aa.js"><link rel="prefetch" href="/dist/assets/js/78.77941a1a.js"><link rel="prefetch" href="/dist/assets/js/79.308133cd.js"><link rel="prefetch" href="/dist/assets/js/8.7e6125ab.js"><link rel="prefetch" href="/dist/assets/js/80.afbf0ddf.js"><link rel="prefetch" href="/dist/assets/js/81.54b08d60.js"><link rel="prefetch" href="/dist/assets/js/82.2612c08a.js"><link rel="prefetch" href="/dist/assets/js/83.fdc29635.js"><link rel="prefetch" href="/dist/assets/js/84.b78caa38.js"><link rel="prefetch" href="/dist/assets/js/85.05ab2ed6.js"><link rel="prefetch" href="/dist/assets/js/86.b1e60e7c.js"><link rel="prefetch" href="/dist/assets/js/87.6801b8b9.js"><link rel="prefetch" href="/dist/assets/js/88.4216564b.js"><link rel="prefetch" href="/dist/assets/js/89.61c35e0c.js"><link rel="prefetch" href="/dist/assets/js/9.deb24178.js"><link rel="prefetch" href="/dist/assets/js/90.1481b0db.js"><link rel="prefetch" href="/dist/assets/js/91.cceae349.js"><link rel="prefetch" href="/dist/assets/js/92.a84097d1.js"><link rel="prefetch" href="/dist/assets/js/93.0110b7bb.js"><link rel="prefetch" href="/dist/assets/js/94.31dcff72.js"><link rel="prefetch" href="/dist/assets/js/95.8ec3e179.js"><link rel="prefetch" href="/dist/assets/js/96.94dfb620.js"><link rel="prefetch" href="/dist/assets/js/97.2a0fd7fc.js"><link rel="prefetch" href="/dist/assets/js/98.e3308b67.js"><link rel="prefetch" href="/dist/assets/js/99.4dee9133.js">
    <link rel="stylesheet" href="/dist/assets/css/0.styles.8ccbe093.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dist/" class="home-link router-link-active"><img src="./logo.jpg" alt="肉肉的博客" class="logo"> <span class="site-name can-hide">肉肉的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dist/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dist/pages/javascript/JavaScript的历史.html" class="nav-link">文章</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/rourou1107" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dist/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dist/pages/javascript/JavaScript的历史.html" class="nav-link">文章</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/rourou1107" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ElementUI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dist/pages/react/how-to-import-react.html" class="sidebar-link">如何引用React</a></li><li><a href="/dist/pages/react/React初体验.html" class="sidebar-link">React初体验</a></li><li><a href="/dist/pages/react/React语法.html" class="sidebar-link">React语法</a></li><li><a href="/dist/pages/react/React之Class组件详解.html" class="active sidebar-link">React之Class组件详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dist/pages/react/React之Class组件详解.html#es5、es6-创建-class-组件写法" class="sidebar-link">ES5、ES6 创建 class 组件写法</a></li><li class="sidebar-sub-header"><a href="/dist/pages/react/React之Class组件详解.html#props（外部数据）" class="sidebar-link">Props（外部数据）</a></li><li class="sidebar-sub-header"><a href="/dist/pages/react/React之Class组件详解.html#state（内部数据）-setstate" class="sidebar-link">State（内部数据） &amp;&amp; setState</a></li><li class="sidebar-sub-header"><a href="/dist/pages/react/React之Class组件详解.html#生命周期钩子" class="sidebar-link">生命周期钩子</a></li></ul></li><li><a href="/dist/pages/react/React之函数组件详解.html" class="sidebar-link">React之函数组件详解</a></li><li><a href="/dist/pages/react/React之useState原理.html" class="sidebar-link">React之useState原理</a></li><li><a href="/dist/pages/react/React之Hooks大全.html" class="sidebar-link">React之Hooks大全</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React之小白</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>流水账</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>自制 UI 框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue3造轮子</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>单元测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目经验</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="es5、es6-创建-class-组件写法"><a href="#es5、es6-创建-class-组件写法" class="header-anchor">#</a> ES5、ES6 创建 class 组件写法</h2> <h3 id="_1、es5-写法（已过时）"><a href="#_1、es5-写法（已过时）" class="header-anchor">#</a> 1、ES5 写法（已过时）</h3> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hi<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>   
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">A</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2、es6-写法"><a href="#_2、es6-写法" class="header-anchor">#</a> 2、ES6 写法</h3> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 这里声明自己的 state --- 数据</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hi<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>   
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">A</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="props（外部数据）"><a href="#props（外部数据）" class="header-anchor">#</a> Props（外部数据）</h2> <ol><li>父组件使用 <code>xxx={this.state.xxx}</code>传数据。子组件使用 <code>this.props</code>接收数据, 如<code>this.props.xxx</code></li> <li>父组件使用 <code>xxxFn={this.xxxFn}</code>传函数。子组件使用 <code>this.props</code>接收函数, 如如<code>this.props.xxxFn</code></li> <li><code>this.props</code>就是接收外部数据的</li> <li>组件接收的props改变时, 会触发<code>UNSAFE_componentWillReciveProps</code>钩子。尽量不要使用这个钩子</li> <li>不要改变外部传来的数据 / 函数。应该有数据的主人来修改。</li></ol> <h2 id="state（内部数据）-setstate"><a href="#state（内部数据）-setstate" class="header-anchor">#</a> State（内部数据） &amp;&amp; setState</h2> <ol><li>初始化 state 是在 constructor 中</li> <li>使用 setState()来修改 state。推荐使用方式二。见下代码</li> <li>每次更新数据其实都是返回一个新的对象</li> <li>会将新的 state 与 旧的 state 进行一级合并</li></ol> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 方式一：使用对象方式更新</span>
    <span class="token comment">// 缺点是，不会立刻改变 state 的值，会在当前代码执行结束后，再去更新 state，从而触发 UI 的更新</span>
    <span class="token comment">// 所以下面函数虽然执行两次setState，但是第二次的 this.state.x 还是在 1 的基础上再加 1</span>
    <span class="token function-variable function">addX1</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 第二个参数是回调函数。修改 state 成功后会调用</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 方式二：使用函数方式更新</span>
    <span class="token function-variable function">addX2</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> state<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> state<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// x 为 3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="生命周期钩子"><a href="#生命周期钩子" class="header-anchor">#</a> 生命周期钩子</h2> <p><img src="/dist/react/life-cicle.png" alt="钩子"></p> <ol><li>constructor 用于初始化数据。如 props、state、绑定this</li></ol> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>addX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addX</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">addX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// 一般不用 bind，直接使用下面的写法</span>
    <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>shouldComponentUpdate(nextProps, nextState) 当数据变化的时候调用。用于我们自己决定是否需要重新 render。true为是，false为否。</li></ol> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> state<span class="token punctuation">.</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> state<span class="token punctuation">.</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 因为从 {x:1} ---&gt; {x:1} 虽然数据对象变了，但是对象里面的属性没变。所以不需要执行 render函数了</span>
    <span class="token comment">// 如果不判断, 那么会执行 render, 会将得到的虚拟 DOM进行比较, 如果一样不会更新UI。否则更新UI</span>
    <span class="token keyword">return</span> nextState<span class="token punctuation">.</span>n <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x<span class="token punctuation">}</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onClick<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>作用：他允许我们手动判断是否需要组件更新，我们可以根据应用场景来灵活的设置返回值，以避免不必要的更新。</p> <ul><li>React.PureComponent 替我们做了手动判断数据是否变化的操作。PureComponent 会在 render 之前对比新的 state 和旧的 state 的每一个 key,
以及新的 props 和旧的 props 的每一个 key。如果所有的 key 都一样, 就不 render, 否则就 render</li></ul> <ol start="3"><li>render 创建虚拟DOM来展示视图 <code>render(){return (&lt;div&gt;&lt;/div&gt;)}</code></li></ol> <ul><li>只能有一个根元素。如果有两个需要使用 <code>&lt;React.Fragment&gt;&lt;/React.Fragment&gt;</code> 或者 <code>&lt;&gt;&lt;/&gt;</code>包起来</li> <li>render 里面可以有 if-else</li></ul> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> state<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> message
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            message <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>偶数<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            message <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>奇数<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span>message<span class="token punctuation">}</span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>render 里面可以有 ? : 表达式</li></ul> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> state<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>偶数<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token punctuation">:</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>奇数<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>如果使用 for 循环需要 返回一个数组。或者直接使用 Array.prototype.map。
<strong>注意：</strong> 返回的如果是一个列表, 必须加上一个独一无二的 key</li></ul> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> tempArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           tempArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>tempArr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 或者使用 map</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol start="4"><li>componentDidMount 当组件挂载时调用。</li></ol> <ul><li>一般依赖于 DOM</li> <li>发起加载数据的 AJAX 请求</li> <li>首次渲染会执行这个钩子</li></ul> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    divRef <span class="token operator">=</span> undefined
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> undefined
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>divRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>divRef<span class="token punctuation">.</span>current
        <span class="token keyword">const</span> <span class="token punctuation">{</span>width<span class="token punctuation">}</span> <span class="token operator">=</span> div<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>divRef<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            hi
            <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>width<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 这里使用了 ref 来获取 DOM</span>
<span class="token comment">// 1. 定义了 ref divRef = undefined</span>
<span class="token comment">// 2. 给 ref 创建一个引用 this.divRef = React.createRef()</span>
<span class="token comment">// 3. 在 虚拟 DOM 中使用 ref</span>
<span class="token comment">// 4. 在 componentDidMount 根据 ref 获取 DOM 元素</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol start="5"><li>componentDidUpdate(prevProps, prevState) 组件更新后会触发这个钩子。</li></ol> <ul><li>发起更新数据的 AJAX 请求（比如用户的userId变了, 需要请求新的 userId）</li> <li>首次渲染不会执行此钩子</li> <li>在此处 setState 可能会无限循环, 除非放在 if 内</li> <li>如果 shouldComponentUpdate 返回 false, 则不执行此钩子</li></ul> <ol start="6"><li>componentWillUnmount 组件要被移出页面并且将要被销毁（从内存中消失）时执行此钩子</li></ol> <ul><li>如果你在组件中的 componentDidMount 中 监听了 window scroll, 那么就需要在 componentWillUnmount 中取消监听</li> <li>如果你在组件中的 componentDidMount 中创建了 Timer, 那么就需要在 componentWillUnmount 中清除 Timer</li> <li>如果你在组件中的 componentDidMount 中创建了 AJAX 请求, 那么就需要在 componentWillUnmount 中取消请求（因为请求可能还没回来）</li> <li>。。。。。。。。。。。。。。</li> <li>上述做法都是为了减少内存的浪费。否则随着时间的推移, 占用内存会越来越大</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dist/pages/react/React语法.html" class="prev">React语法</a></span> <span class="next"><a href="/dist/pages/react/React之函数组件详解.html">React之函数组件详解</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/dist/assets/js/app.a7341da6.js" defer></script><script src="/dist/assets/js/2.4917c22f.js" defer></script><script src="/dist/assets/js/58.617cc871.js" defer></script>
  </body>
</html>
